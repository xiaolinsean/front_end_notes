- [1、winscp + putty](#1winscp--putty)
- [2、安装nginx](#2安装nginx)
- [3、](#3)

## 1、winscp + putty

参考：[WinSCP+PuTTY搭配使用 ，解决Windows连接Linux系统文件传输和终端登陆](https://blog.csdn.net/weixin_41140174/article/details/82939304)

## 2、安装nginx

- 安装依赖
    ```shell
    yum install gcc-c++

    yum install -y pcre pcre-devel

    yum install -y zlib zlib-devel

    yum install -y openssl openssl-devel

    ```

- 下载nginx安装包并安装
    
    通过[官网](https://nginx.org/en/download.html)下载，建议选择 `Stable version`

    或者直接在linux执行命令：wget http://nginx.org/download/nginx-1.12.2.tar.gz

    将下载的安装包移动到对应的目录下（/usr/local/nginx），然后解压缩安装

    ```shell
    # 解压
    tar -zxvf nginx-1.20.2.tar.gz
    # 进入解压后的目录
    cd nginx-1.20.2/
    # 执行配置
    ./configure --prefix=/usr/local/nginx
    # 编译安装(默认安装在/usr/local/nginx)
    make
    make install
    ```

- 启动nginx
    
    nginx主配置文件：/usr/local/nginx/conf/nginx.conf

    启动：
    ```shell
    cd /usr/local/nginx/sbin

    ./nginx
    ```

## 3、内网下安装参考：https://www.cnblogs.com/nvyuan/p/15247562.html

## 4、logrotate日志切割

logrotate 的主要配置文件是：/etc/logrotate.conf ，以及 /etc/logrotate.d/ 目录下面放置自定义的一些配置文件。比如我们可以将nginx 的相关轮转日志放到 /etc/logrotate.d/ 目录下。

```shell
# /etc/logrotate.d/nginx
/usr/local/nginx/logs/*.log{
        #每天进行轮转
        daily
        #保留20个日志文件
        rotate 30
        #当日志文件大于100k后进行日志轮转
        size 100k
        #指定新建的日志文件权限以及所属用户和组
        create 644 root root
        #日志文件名中增加时间
        dateext
        # 结合dateext 实现文件的命名
        dateformat -%Y%m%d
        # 归档时间以实际归档的前一天为时间戳
        dateyesterday
        # 扩展名
        extension .txt
        #忽略错误
        missingok
        #copytruncate
        #分享脚本，如果没有配置这个，日志目录下有多个日志时，下面的脚本会执行多                                        次
        sharedscripts
        postrotate
                 if [ -f /usr/local/nginx/logs/nginx.pid ]; then
                         kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`
                 fi
        endscript
```
详细参数可参考：[https://www.w3schools.cn/nginx/nginx_log_logrotate.asp](https://www.w3schools.cn/nginx/nginx_log_logrotate.asp)

logrotate 自动执行日志切割的时间在/etc/anacrontab中配置
```shell
# /etc/anacrontab: configuration file for anacron

# See anacron(8) and anacrontab(5) for details.

SHELL=/bin/sh
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
# the maximal random delay added to the base delay of the jobs
RANDOM_DELAY=45
# the jobs will be started during the following hours only
START_HOURS_RANGE=0-1

#period in days   delay in minutes   job-identifier   command
1       5       cron.daily              nice run-parts /etc/cron.daily
7       25      cron.weekly             nice run-parts /etc/cron.weekly
@monthly 45     cron.monthly            nice run-parts /etc/cron.monthly
```

设置 START_HOURS_RANGE=0-1 配合 nginx 中的 dateyesterday 可以在零点切割出前一天的日志，注意切割后的日志后缀名，防止重复切割

